<div *ngIf="trackTableDataObs | async as trackTableData">
  <table
    mat-table
    [dataSource]="trackTableData.dataSource"
    matSort
    matSortDisableClear
    cdkDropList
    [cdkDropListDisabled]="!trackTableData.dragEnabled"
    [cdkDropListData]="trackTableData.dataSource.data"
    (cdkDropListDropped)="onListDrop($event)"
  >
    <!-- Track number on the queue or album / directory -->
    <ng-container matColumnDef="position">
      <th
        mat-header-cell
        mat-sort-header
        [disabled]="!trackTableData.sortable"
        *matHeaderCellDef
      >
        #
      </th>
      <td
        mat-cell
        *matCellDef="let row"
        (click)="onRowClick(row)"
        class="text-muted"
      >
        {{ row.position + 1 }}
      </td>
    </ng-container>

    <!-- Artist column. Shows the file name if none of artist/album/title is present -->
    <ng-container matColumnDef="artist-name">
      <th
        mat-header-cell
        mat-sort-header
        [disabled]="!trackTableData.sortable"
        *matHeaderCellDef
      >
        Artist
      </th>
      <td
        mat-cell
        *matCellDef="let row"
        (click)="onRowClick(row)"
        [ngClass]="(isMobile | async) ? 'mobile' : ''"
      >
        <span
          *ngIf="
            !row.artistName && !row.albumName && !row.title;
            else hasArtistName
          "
        >
          {{ row.file }}
        </span>
        <ng-template #hasArtistName>
          {{ row.artistName }}
        </ng-template>
      </td>
    </ng-container>

    <!-- Album column -->
    <ng-container matColumnDef="album-name">
      <th
        mat-header-cell
        mat-sort-header
        [disabled]="!trackTableData.sortable"
        *matHeaderCellDef
      >
        Album
      </th>
      <td
        mat-cell
        *matCellDef="let row"
        (click)="onRowClick(row)"
        [class.mobile]="isMobile | async"
      >
        {{ row.albumName }}
      </td>
    </ng-container>

    <!-- Title column -->
    <ng-container matColumnDef="title">
      <th
        mat-header-cell
        mat-sort-header
        [disabled]="!trackTableData.sortable"
        *matHeaderCellDef
      >
        Title
      </th>
      <td
        mat-cell
        *matCellDef="let row"
        (click)="onRowClick(row)"
        [ngClass]="(isMobile | async) ? 'mobile' : ''"
      >
        {{ row.title }}
      </td>
    </ng-container>

    <!-- Length column -->
    <ng-container matColumnDef="length">
      <th
        mat-header-cell
        mat-sort-header
        [disabled]="!trackTableData.sortable"
        *matHeaderCellDef
      >
        Duration
      </th>
      <td
        mat-cell
        *matCellDef="let row"
        (click)="onRowClick(row)"
        [class.mobile]="isMobile | async"
      >
        {{ row.length | secondsToMmSs }}
      </td>
    </ng-container>

    <!-- Button: Remove track from queue -->
    <ng-container matColumnDef="remove">
      <th mat-header-cell *matHeaderCellDef></th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngClass]="(isMobile | async) ? 'mobile ' : ''"
      >
        <mat-icon
          class="btn-remove-track"
          title="Remove from queue"
          (click)="onRemoveTrack(element.position)"
          >backspace
        </mat-icon>
      </td>
    </ng-container>

    <!-- Button: Play track -->
    <ng-container
      matColumnDef="play-title"
      *ngIf="trackTableData.playTitleColumn"
    >
      <th mat-header-cell *matHeaderCellDef></th>
      <td
        mat-cell
        *matCellDef="let track"
        [ngClass]="(isMobile | async) ? 'mobile ' : ''"
      >
        <button mat-button (click)="onPlayTrack(track)" title="Play this track">
          <mat-icon> play_arrow</mat-icon>
        </button>
      </td>
    </ng-container>

    <!-- Button: Add track to queue -->
    <ng-container
      matColumnDef="add-title"
      *ngIf="trackTableData.addTitleColumn"
    >
      <th mat-header-cell *matHeaderCellDef></th>
      <td
        mat-cell
        *matCellDef="let track"
        [ngClass]="(isMobile | async) ? 'mobile ' : ''"
      >
        <button
          mat-button
          (click)="onAddTrack(track)"
          title="Add this track to the queue"
        >
          <mat-icon>add </mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="info">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let track">
        <button
          mat-button
          (click)="onShowTrackInfo(track)"
          title="Show track info"
        >
          <mat-icon>info </mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="trackTableData.displayedColumns"></tr>

    <tr
      mat-row
      *matRowDef="let row; columns: trackTableData.displayedColumns"
      class="table-row"
      [ngClass]="{
        themedbg: row.playing === true,
        playing: row.playing === true
      }"
      cdkDrag
    ></tr>
  </table>
  <div
    [hidden]="
      trackTableData.dataSource.data.length === 0 || trackTableData.pageSize < 2
    "
  >
    <mat-paginator
      [length]="trackTableData.totalElements"
      [pageIndex]="trackTableData.pageIndex"
      [pageSize]="trackTableData.pageSize"
      [pageSizeOptions]="trackTableData.pageSizeOptions"
      (page)="handlePage($event)"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
